<div class="page-table trader-page">
  <div id="trader-root">
    <!-- Tab Content Area -->
    <div id="trader-content">
      <!-- Stats Tab -->
      <div id="stats-tab" class="trader-tab-content" style="display: none">
        <div class="stats-grid">
          <!-- Key Performance Indicators -->
          <div class="stats-section stats-section-primary">
            <div class="section-header">
              <div>
                <h3><i class="icon-bar-chart-2"></i> Performance Overview</h3>
                <p class="section-subtitle">Last 30 days trading performance</p>
              </div>
              <div class="stats-period" id="stats-period">Loading...</div>
            </div>
            <div class="metrics-grid">
              <div class="metric-card metric-card-primary">
                <div class="metric-icon">
                  <i class="icon-trending-up"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Win Rate</div>
                  <div class="metric-value" id="win-rate">—</div>
                  <div class="metric-detail" id="win-rate-detail">—</div>
                </div>
              </div>
              <div class="metric-card metric-card-primary">
                <div class="metric-icon">
                  <i class="icon-activity"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Total P&L</div>
                  <div class="metric-value" id="total-pnl">—</div>
                  <div class="metric-detail" id="total-pnl-detail">—</div>
                </div>
              </div>
              <div class="metric-card">
                <div class="metric-icon">
                  <i class="icon-repeat"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Total Trades</div>
                  <div class="metric-value" id="total-trades">—</div>
                  <div class="metric-detail" id="total-trades-detail">—</div>
                </div>
              </div>
              <div class="metric-card">
                <div class="metric-icon">
                  <i class="icon-clock"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Avg Hold Time</div>
                  <div class="metric-value" id="avg-hold-time">—</div>
                  <div class="metric-detail" id="avg-hold-time-detail">—</div>
                </div>
              </div>
              <div class="metric-card metric-highlight-success">
                <div class="metric-icon">
                  <i class="icon-arrow-up"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Best Trade</div>
                  <div class="metric-value" id="best-trade">—</div>
                  <div class="metric-detail" id="best-trade-detail">—</div>
                </div>
              </div>
              <div class="metric-card metric-highlight-danger">
                <div class="metric-icon">
                  <i class="icon-arrow-down"></i>
                </div>
                <div class="metric-content">
                  <div class="metric-label">Worst Trade</div>
                  <div class="metric-value" id="worst-trade">—</div>
                  <div class="metric-detail" id="worst-trade-detail">—</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Exit Strategy Performance -->
          <div class="stats-section">
            <div class="section-header">
              <h3><i class="icon-trending-up"></i> Exit Strategy Breakdown</h3>
              <p class="section-subtitle">How positions were closed and their outcomes</p>
            </div>
            <div id="exit-breakdown" class="exit-breakdown">
              <div class="loading-state">
                <i class="icon-loader"></i>
                <span>Loading exit data...</span>
              </div>
            </div>
          </div>

          <!-- Active Positions Summary -->
          <div class="stats-section">
            <div class="section-header">
              <h3><i class="icon-target"></i> Active Positions Summary</h3>
              <p class="section-subtitle">Current open positions and risk exposure</p>
            </div>
            <div id="positions-summary" class="positions-summary">
              <div class="info-state">
                <i class="icon-inbox"></i>
                <span>No open positions</span>
              </div>
            </div>
          </div>

          <!-- System Health & Activity -->
          <div class="stats-section">
            <div class="section-header">
              <h3><i class="icon-cpu"></i> System Health</h3>
              <p class="section-subtitle">Trader components status and activity</p>
            </div>
            <div class="health-grid">
              <div class="health-card">
                <div class="health-icon" id="trader-icon">
                  <i class="icon-zap"></i>
                </div>
                <div class="health-content">
                  <div class="health-label">Trader Engine</div>
                  <div class="health-value" id="trader-status">—</div>
                  <div class="health-detail" id="trader-detail"></div>
                </div>
              </div>
              <div class="health-card">
                <div class="health-icon" id="entry-icon">
                  <i class="icon-log-in"></i>
                </div>
                <div class="health-content">
                  <div class="health-label">Entry Monitor</div>
                  <div class="health-value" id="entry-monitor">—</div>
                  <div class="health-detail" id="entry-detail"></div>
                </div>
              </div>
              <div class="health-card">
                <div class="health-icon" id="exit-icon">
                  <i class="icon-log-out"></i>
                </div>
                <div class="health-content">
                  <div class="health-label">Exit Monitor</div>
                  <div class="health-value" id="exit-monitor">—</div>
                  <div class="health-detail" id="exit-detail"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Trailing Stop Tab -->
      <div id="trailing-stop-tab" class="trader-tab-content" style="display: none">
        <div class="trailing-stop-container">
          <!-- Configuration Section -->
          <div class="config-section">
            <div class="section-header">
              <div>
                <h3><i class="icon-trending-up"></i> Trailing Stop Configuration</h3>
                <p class="section-subtitle">Protect profits while letting winners run</p>
              </div>
            </div>

            <div class="config-card">
              <!-- Enable/Disable -->
              <div class="config-group config-group-primary">
                <div class="config-toggle">
                  <label class="toggle-label" for="trailing-enabled">
                    <div class="toggle-header">
                      <div class="toggle-title">
                        <i class="icon-shield"></i>
                        <span>Enable Trailing Stop</span>
                      </div>
                      <div class="toggle-switch">
                        <input type="checkbox" id="trailing-enabled" />
                        <span class="toggle-slider"></span>
                      </div>
                    </div>
                    <p class="toggle-description">Automatically protect profits when positions reach target gains</p>
                  </label>
                </div>
              </div>

              <!-- Activation Threshold -->
              <div class="config-group">
                <div class="config-label-row">
                  <label for="trail-activation" class="config-label">
                    <i class="icon-trending-up"></i>
                    <span>Activation Threshold</span>
                  </label>
                  <span class="config-badge config-badge-info">When to start</span>
                </div>
                <p class="config-hint">Begin trailing when position profit reaches this percentage</p>
                <div class="input-group-enhanced">
                  <input
                    type="number"
                    id="trail-activation"
                    min="0"
                    max="100"
                    step="1"
                    value="10"
                    class="input-large"
                  />
                  <span class="input-unit">%</span>
                  <div class="input-indicator" id="activation-indicator"></div>
                </div>
                <div class="config-impact">
                  <span class="impact-label">Impact:</span>
                  <span class="impact-text" id="activation-impact">Starts trailing at +10% profit</span>
                </div>
              </div>

              <!-- Trail Distance -->
              <div class="config-group">
                <div class="config-label-row">
                  <label for="trail-distance" class="config-label">
                    <i class="icon-arrow-down"></i>
                    <span>Trail Distance</span>
                  </label>
                  <span class="config-badge config-badge-warning">Safety margin</span>
                </div>
                <p class="config-hint">Exit if price drops this much from highest point reached</p>
                <div class="input-group-enhanced">
                  <input
                    type="number"
                    id="trail-distance"
                    min="0"
                    max="50"
                    step="1"
                    value="5"
                    class="input-large"
                  />
                  <span class="input-unit">%</span>
                  <div class="input-indicator" id="distance-indicator"></div>
                </div>
                <div class="config-impact">
                  <span class="impact-label">Impact:</span>
                  <span class="impact-text" id="distance-impact">Exits at -5% from peak</span>
                </div>
              </div>

              <!-- Visual Example -->
              <div class="visual-example">
                <h4><i class="icon-bar-chart-2"></i> How It Works</h4>
                <div class="example-timeline">
                  <div class="timeline-step">
                    <div class="step-icon step-icon-entry">
                      <i class="icon-arrow-right"></i>
                    </div>
                    <div class="step-content">
                      <div class="step-title">Entry</div>
                      <div class="step-value" id="example-entry">0.001000 SOL</div>
                      <div class="step-detail">Initial position</div>
                    </div>
                  </div>
                  <div class="timeline-arrow"><i class="icon-chevron-right"></i></div>
                  <div class="timeline-step">
                    <div class="step-icon step-icon-activation">
                      <i class="icon-zap"></i>
                    </div>
                    <div class="step-content">
                      <div class="step-title">Activation</div>
                      <div class="step-value" id="example-activation">0.001100 SOL</div>
                      <div class="step-detail" id="example-activation-pct">+10% profit</div>
                    </div>
                  </div>
                  <div class="timeline-arrow"><i class="icon-chevron-right"></i></div>
                  <div class="timeline-step">
                    <div class="step-icon step-icon-peak">
                      <i class="icon-trending-up"></i>
                    </div>
                    <div class="step-content">
                      <div class="step-title">Peak</div>
                      <div class="step-value" id="example-peak">0.001200 SOL</div>
                      <div class="step-detail" id="example-peak-pct">+20% profit</div>
                    </div>
                  </div>
                  <div class="timeline-arrow"><i class="icon-chevron-right"></i></div>
                  <div class="timeline-step">
                    <div class="step-icon step-icon-exit">
                      <i class="icon-log-out"></i>
                    </div>
                    <div class="step-content">
                      <div class="step-title">Exit</div>
                      <div class="step-value" id="example-exit">0.001140 SOL</div>
                      <div class="step-detail" id="example-exit-pct">+14% final</div>
                    </div>
                  </div>
                </div>
                <div class="example-summary">
                  <div class="summary-item summary-item-success">
                    <i class="icon-check-circle"></i>
                    <span>Protected <strong id="example-protected">14%</strong> profit</span>
                  </div>
                  <div class="summary-item summary-item-info">
                    <i class="icon-shield"></i>
                    <span>Avoided <strong id="example-avoided">6%</strong> loss from peak</span>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="form-actions">
                <button class="btn btn-primary" id="save-trailing">
                  <i class="icon-save"></i>
                  <span>Save Configuration</span>
                </button>
                <button class="btn btn-secondary" id="reset-trailing">
                  <i class="icon-rotate-ccw"></i>
                  <span>Reset to Defaults</span>
                </button>
              </div>
            </div>

            <!-- Advanced Features (Coming Soon) -->
            <div class="feature-preview">
              <div class="feature-header">
                <h4><i class="icon-star"></i> Coming Soon</h4>
                <span class="badge badge-warning">Phase 3</span>
              </div>
              <div class="feature-grid">
                <div class="feature-item">
                  <i class="icon-layers"></i>
                  <div class="feature-content">
                    <div class="feature-title">Multi-Level Trailing</div>
                    <div class="feature-desc">Different trail distances at different profit levels</div>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="icon-clock"></i>
                  <div class="feature-content">
                    <div class="feature-title">Time-Based Adjustments</div>
                    <div class="feature-desc">Tighten trail distance based on holding period</div>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="icon-activity"></i>
                  <div class="feature-content">
                    <div class="feature-title">Volatility Adaptation</div>
                    <div class="feature-desc">Auto-adjust trail distance based on price volatility</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Stats Section -->
          <div class="stats-section-compact">
            <h4><i class="icon-bar-chart-2"></i> Trailing Stop Performance</h4>
            <div class="quick-stats">
              <div class="quick-stat-card">
                <div class="quick-stat-value" id="trailing-exits-count">—</div>
                <div class="quick-stat-label">Total Exits</div>
              </div>
              <div class="quick-stat-card">
                <div class="quick-stat-value" id="trailing-avg-profit">—</div>
                <div class="quick-stat-label">Avg Profit</div>
              </div>
              <div class="quick-stat-card">
                <div class="quick-stat-value" id="trailing-best-save">—</div>
                <div class="quick-stat-label">Best Save</div>
              </div>
              <div class="quick-stat-card">
                <div class="quick-stat-value" id="trailing-active-count">—</div>
                <div class="quick-stat-label">Active Now</div>
              </div>
            </div>
          </div>
        </div>
      </div>
                <div class="preview-row">
                  <span>Estimated Profit:</span>
                  <span id="preview-estimated-profit" class="profit-value">—</span>
                </div>
              </div>

              <div class="preview-section">
                <h4>What-If Analysis</h4>
                <div id="preview-what-if-scenarios">
                  <!-- Populated dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Take Profit (ROI) Tab -->
      <div id="roi-tab" class="trader-tab-content" style="display: none">
        <div class="config-form">
          <h3><i class="icon-target"></i> ROI Exit Configuration</h3>

          <div class="form-section">
            <h4><i class="icon-settings"></i> Basic Settings</h4>
            <div class="form-group">
              <label for="roi-enabled">
                <input type="checkbox" id="roi-enabled" />
                Enable ROI-Based Exit
              </label>
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-target"></i> Single Target (Current)</h4>
            <div class="form-group">
              <label for="roi-target">
                Target ROI
                <span class="hint">Automatically exit when profit reaches this %</span>
              </label>
              <div class="input-with-unit">
                <input type="number" id="roi-target" min="1" max="1000" step="1" value="20" />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="form-group">
              <label>Exit Amount</label>
              <div class="info-text">100% (full position)</div>
            </div>

            <div class="example-box">
              <strong><i class="icon-lightbulb"></i></strong> Exit entire position when profit reaches +<span id="roi-example">20</span>%
            </div>
          </div>

          <div class="form-section disabled">
            <h4><i class="icon-target"></i> Ladder Targets (Advanced - Future) <span class="badge warning">UPGRADE</span></h4>
            <div class="info-message">
              Multi-level profit targets require backend changes. Coming in Phase 3.
            </div>
          </div>

          <div class="form-actions">
            <button class="btn primary" id="save-roi">Save Changes</button>
            <button class="btn secondary" id="reset-roi">Reset to Defaults</button>
          </div>
        </div>
      </div>

      <!-- Time Rules Tab -->
      <div id="time-rules-tab" class="trader-tab-content" style="display: none">
        <div class="config-form">
          <h3><i class="icon-clock"></i> Time-Based Exit Rules</h3>

          <div class="form-section">
            <h4><i class="icon-settings"></i> Basic Settings</h4>
            <div class="form-group">
              <label for="time-override-enabled">
                <input type="checkbox" id="time-override-enabled" />
                Enable Time-Based Exit Override
              </label>
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-clock"></i> Time Override Configuration</h4>
            <div class="form-group">
              <label for="time-max-hold">
                Hold Duration Limit
                <span class="hint">Exit positions held longer than this duration</span>
              </label>
              <div class="input-with-unit-group">
                <input
                  type="number"
                  id="time-max-hold"
                  min="1"
                  max="43200"
                  step="1"
                  value="168"
                />
                <select id="time-unit" class="unit-select">
                  <option value="seconds">seconds</option>
                  <option value="minutes">minutes</option>
                  <option value="hours" selected>hours</option>
                  <option value="days">days</option>
                </select>
              </div>
              <div class="hint-text" id="time-conversion-hint">168 hours = 7 days</div>
            </div>

            <div class="form-group">
              <label for="time-loss-threshold">
                Loss Threshold
                <span class="hint">Only exit if position loss exceeds this % (negative value)</span>
              </label>
              <div class="input-with-unit">
                <input
                  type="number"
                  id="time-loss-threshold"
                  min="-100"
                  max="0"
                  step="1"
                  value="-40"
                />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="example-box">
              <strong><i class="icon-lightbulb"></i> How it works:</strong> 
              After holding a position for <span id="example-duration">7 days</span>, 
              automatically exit if the position is down <span id="example-loss">40%</span> or more.
              <br><br>
              <strong>Note:</strong> Positions at profit or smaller losses will NOT be exited.
            </div>

            <div class="form-group">
              <label>Current Positions Status:</label>
              <div id="time-positions-status" class="status-list">
                <div class="loading">Loading positions...</div>
              </div>
            </div>
          </div>

          <div class="form-section disabled">
            <h4><i class="icon-target"></i> Escalation Rules (Advanced - Future) <span class="badge warning">UPGRADE</span></h4>
            <div class="info-message">
              Time-based rule escalation requires backend changes. Coming in Phase 3.
            </div>
          </div>

          <div class="form-actions">
            <button class="btn primary" id="save-time-rules">Save Changes</button>
            <button class="btn secondary" id="reset-time-rules">Reset to Defaults</button>
          </div>
        </div>
      </div>

      <!-- Strategy Control Tab -->
      <div id="strategy-control-tab" class="trader-tab-content" style="display: none">
        <div class="config-form">
          <h3><i class="icon-puzzle"></i> Strategy Integration Control</h3>

          <div class="info-box">
            <strong><i class="icon-lightbulb"></i></strong> Manage which strategies the trader uses for entry/exit decisions.
            Create/edit strategies in the
            <a href="#" data-page="strategies" class="link">Strategies tab</a>.
          </div>

          <div class="form-section">
            <h4><i class="icon-target"></i> Entry Strategies</h4>
            <div id="entry-strategies" class="strategies-list">
              <div class="loading">Loading strategies...</div>
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-log-out"></i> Exit Strategies</h4>
            <div id="exit-strategies" class="strategies-list">
              <div class="loading">Loading strategies...</div>
            </div>
          </div>

          <div class="form-section disabled">
            <h4><i class="icon-settings"></i> Strategy Voting Mode (Advanced - Future) <span class="badge warning">UPGRADE</span></h4>
            <div class="info-message">
              Strategy voting modes require backend changes. Coming in Phase 3.
            </div>
          </div>

          <div class="form-actions">
            <button class="btn primary" id="save-strategies">Save Changes</button>
            <button class="btn secondary" id="refresh-strategies">Refresh List</button>
          </div>
        </div>
      </div>

      <!-- General Settings Tab -->
      <div id="general-settings-tab" class="trader-tab-content" style="display: none">
        <div class="config-form">
          <h3><i class="icon-settings"></i> General Trader Settings</h3>

          <div class="form-section">
            <h4><i class="icon-target"></i> Position Sizing</h4>
            <div class="form-group">
              <label for="max-positions">
                Max Open Positions
                <span class="hint">1-100, conservative: 2-5</span>
              </label>
              <input type="number" id="max-positions" min="1" max="100" step="1" value="2" />
            </div>

            <div class="form-group">
              <label for="trade-size">
                Default Trade Size
                <span class="hint">SOL per position</span>
              </label>
              <div class="input-with-unit">
                <input
                  type="number"
                  id="trade-size"
                  min="0.001"
                  max="10"
                  step="0.001"
                  value="0.005"
                />
                <span class="unit">SOL</span>
              </div>
            </div>

            <div class="form-group">
              <label for="entry-sizes">
                Preset Entry Sizes
                <span class="hint">Comma-separated SOL amounts (e.g., 0.005, 0.01, 0.02)</span>
              </label>
              <input
                type="text"
                id="entry-sizes"
                placeholder="0.005, 0.01, 0.02, 0.05"
                value="0.005, 0.01, 0.02, 0.05"
              />
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-dollar-sign"></i> DCA (Dollar Cost Averaging)</h4>
            <div class="form-group">
              <label for="dca-enabled">
                <input type="checkbox" id="dca-enabled" />
                Enable DCA
              </label>
            </div>

            <div class="form-group">
              <label for="dca-threshold">
                DCA Threshold
                <span class="hint">Enter DCA when position is down by this %</span>
              </label>
              <div class="input-with-unit">
                <input
                  type="number"
                  id="dca-threshold"
                  min="-100"
                  max="0"
                  step="1"
                  value="-10"
                />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="form-group">
              <label for="dca-max-count">
                Max DCA Count
                <span class="hint">Maximum additional entries per position</span>
              </label>
              <input type="number" id="dca-max-count" min="1" max="5" step="1" value="2" />
            </div>

            <div class="form-group">
              <label for="dca-size">
                DCA Size
                <span class="hint">% of initial position size for each DCA</span>
              </label>
              <div class="input-with-unit">
                <input type="number" id="dca-size" min="10" max="200" step="10" value="50" />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="form-group">
              <label for="dca-cooldown">
                DCA Cooldown
                <span class="hint">Minutes between DCA entries</span>
              </label>
              <div class="input-with-unit">
                <input type="number" id="dca-cooldown" min="1" max="1440" step="5" value="30" />
                <span class="unit">minutes</span>
              </div>
            </div>

            <div class="example-box">
              <strong><i class="icon-lightbulb"></i> Example:</strong> 0.01 SOL initial → DCA #1: 0.005 SOL @ -10% → DCA #2:
              0.005 SOL @ -10% more
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-clock"></i> Timing & Cooldowns</h4>
            <div class="form-group">
              <label for="close-cooldown">
                Position Close Cooldown
                <span class="hint">Minutes before reopening same token</span>
              </label>
              <div class="input-with-unit">
                <input
                  type="number"
                  id="close-cooldown"
                  min="0"
                  max="1440"
                  step="5"
                  value="15"
                />
                <span class="unit">minutes</span>
              </div>
            </div>

            <div class="form-group">
              <label for="entry-concurrency">
                Entry Check Concurrency
                <span class="hint">Tokens to check at once (higher = faster but more CPU)</span>
              </label>
              <input type="number" id="entry-concurrency" min="1" max="50" step="1" value="10" />
            </div>

            <div class="form-group readonly">
              <label>
                Entry Monitor Interval
                <span class="hint">Configured in code (not editable)</span>
              </label>
              <div class="readonly-value">30s</div>
            </div>

            <div class="form-group readonly">
              <label>
                Exit Monitor Interval
                <span class="hint">Configured in code (not editable)</span>
              </label>
              <div class="readonly-value">5s</div>
            </div>
          </div>

          <div class="form-section">
            <h4><i class="icon-flask-conical"></i> Testing & Debug</h4>
            <div class="form-group">
              <label for="dry-run">
                <input type="checkbox" id="dry-run" />
                Dry Run Mode
                <span class="hint">Simulate trades without executing</span>
              </label>
            </div>

            <div id="dry-run-warning" class="warning-box" style="display: none">
              <i class="icon-alert-triangle"></i> <strong>LIVE TRADING MODE:</strong> Real transactions will execute!
            </div>
          </div>

          <div class="form-actions">
            <button class="btn primary" id="save-general">Save Changes</button>
            <button class="btn secondary" id="reset-general">Reset to Defaults</button>
            <button class="btn secondary" id="export-config">Export Config</button>
            <button class="btn secondary" id="import-config">Import Config</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
